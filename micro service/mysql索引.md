##  索引

> 索引是帮助mysql高效获取数据的排好序的数据结构

*索引数据结构*

* 二叉树

  如果是顺序存储的话，索引递增，二叉树失效

* 红黑树

  数据量大的话，树的高度不可控，思考可以在每个节点上增加更多的节点B树
  $$
  数据量=2^n
  $$
  
* Hash表

  

* B-Tree

  如果引擎数据的话，一个分片是16KB。由于把数据也存储在了节点中，字段太多，会导致索引元素降低

  并且B树的所有索引都是唯一，不重复的

  ![image-20200815191347862](https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuqqt3h4aj311w0de46p.jpg)

* B+ Tree

  1） 非叶子节点不存储data，只存储索引（冗余），可以放更多的索引

 2）叶子节点包含所有索引字段

 3）叶子节点用指针连接，提高区间访问性能

> mysql为啥是16KB，是满足磁盘IO。bigint 是8个字节，mysql内存设置6个字节作为索引。mysql内部的一个索引包含一个bigint的值，还有一个6位的索引。因此一个完整的节点是6+8=14个字节。一个mysql的分片是16K，因此一个大节点，可以存储16K/14B = 1170个。因此一个3层的B+树（每行数据的大小是1KB)，那么一共可以存储 1170x1170x16=2000W+

4） 叶子节点上，有个双向指针，方便范围查询



## mysql存储引擎

> 存储引擎最终修改的是表

* MyIsAM

  .MYI  文件是B+树存储的索引

  .MYD 存储的是所有行数据

  主键非主键差别不大（但是InnoDB是不一样的）

  <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuqqy6fovj30tc0myjy4.jpg" alt="image-20200815204412043" style="zoom:50%;" />

* InnoDB（frm,ibd文件)

  1） 表数据文件本身就是按B+ Tree组织的一个索引结构文件

  2)   聚集索引-叶节点包含了完整的数据记录（放在一个文件）

 3)  叶子节点上存储表中的所有数据

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuqr1gld7j311m0gg79z.jpg" alt="image-20200815204345711 " style="zoom:50%;" />

4： 为什么必须要有主键，并且推荐使用整形的自增主键？

>  如果是字符串的话，占用索引的空间，比较大小计算繁琐
>
>  如果新加入的元素有可能要插入到叶子中间位置，而这个叶子已经满了，会导致裂变和平衡

5：为什么非主键索引结构叶子节点存储的是主键值？（一致性和节省存储空间）

> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuqr4r2p5j30we0de0xn.jpg" alt="image-20200815205512684 " style="zoom:33%;" />
>
> 非主键索引先根据非主键找到主键索引的ID，然后再根据主键索引ID再次查询。  为什么这样做是为了保持一致性，完整数据保持一份

* 联合索引的底层存储结构长什么样？

  <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghuqr8jmihj311y0fqaho.jpg" alt="image-20200815210120560" style="zoom:33%;" />

逐个字段去比较大小，先比较10002，然后再比较staff,最后再比较1996-08-03







